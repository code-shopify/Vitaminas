{% schema %}
{
  "name": "TikTok Slider",
  "settings": [
    {
      "type": "text",
      "id": "rating",
      "label": "Calificación (Ejemplo: 4.8)",
      "default": "4.8"
    },
    {
      "type": "text",
      "id": "reviews",
      "label": "Número de reseñas",
      "default": "1,450 reviews"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Título principal",
      "default": "Opinan de Vitatú"
    },
    {
      "type": "textarea",
      "id": "bottom_message",
      "label": "Mensaje inferior",
      "default": "*EL CONSUMO DE ESTE PRODUCTO ES RESPONSABILIDAD DE QUIÉN LO RECOMIENDA Y DE QUIÉN LO USA, ESTE PRODUCTO NO ES UN MEDICAMENTO*"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Color de fondo",
      "default": "#FEF8F0"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color del texto",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "num_videos",
      "label": "Número de TikToks",
      "min": 1,
      "max": 10,
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "video",
      "name": "TikTok Video",
      "settings": [
        {
          "type": "url",
          "id": "video_url",
          "label": "URL del Video de TikTok"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "TikTok Slider",
      "category": "Multimedia"
    }
  ]
}
{% endschema %}

<div class="tiktok-slider-container" style="background-color: {{ section.settings.background_color }}; color: {{ section.settings.text_color }};">
  
  <!-- Contenido Superior -->
  <div class="tiktok-slider-header">
    <div class="rating-container">
      <span class="rating-value">{{ section.settings.rating }}</span>
      <span class="stars">★★★★★</span>
      <span class="reviews"><a href="#">{{ section.settings.reviews }}</a></span>
    </div>
    <h2 class="slider-title">{{ section.settings.title }}</h2>
  </div>

  <!-- Carrusel de TikToks -->
  <div class="tiktok-carousel">
    <div class="tiktok-slider">
      {% for block in section.blocks limit: section.settings.num_videos %}
        {% if block.settings.video_url contains "/video/" %}
          {% assign video_id = block.settings.video_url | split: "/video/" | last | split: "?" | first %}
          <div class="tiktok-slide">
            <div class="with-border">
              <iframe class="tiktok-embed" 
                src="https://www.tiktok.com/embed/{{ video_id }}?embedId=1&autoplay=0&muted=0" 
                frameborder="0" 
                allow="autoplay; fullscreen; picture-in-picture" 
                scrolling="no"
                data-video>
              </iframe>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>

  <!-- Contenido Inferior -->
  <p class="bottom-message">{{ section.settings.bottom_message }}</p>

</div>

<style>
/* Contenedor principal */
.tiktok-slider-container {
  text-align: center;
  padding: 20px;
  border-radius: 10px;
  position: relative;
}

/* Contenido superior */
.tiktok-slider-header {
  margin-bottom: 10px;
}

.rating-container {
  font-size: 16px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 5px;
}

.stars {
  color: gold;
  font-size: 16px;
}

.reviews a {
  color: inherit;
  text-decoration: none;
  font-weight: bold;
}

/* Título */
.slider-title {
  font-size: 24px;
  font-weight: bold;
}

/* Carrusel */
.tiktok-carousel {
  overflow: hidden;
  position: relative;
}

.tiktok-slider {
  display: flex;
  transition: transform 0.5s ease-in-out;
}

/* Slides */
.tiktok-slide {
  flex: 0 0 20%;
  max-width: 20%;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
}

/* Estilos del Marco */
.with-border {
    padding: 6px;
    border-radius: 15px;
    border: 3px solid transparent;
    background: linear-gradient(to bottom, #00ffff, #ff2d55);
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

/* Ajuste del TikTok al cuadro */
.tiktok-embed {
    width: 100%;
    height: 100%;
    border-radius: 12px;
    object-fit: cover;
    aspect-ratio: 9 / 16;
}

/* Contenido inferior */
.bottom-message {
  margin-top: 20px;
  font-size: 14px;
  font-style: italic;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const videos = document.querySelectorAll(".tiktok-embed");
  
    videos.forEach(video => {
        video.addEventListener("mouseenter", () => {
            videos.forEach(v => {
                if (v !== video) {
                    v.src = v.src; // Reinicia los demás videos para detener su reproducción
                }
            });
        });
    });

    let currentIndex = 0;
    const slides = document.querySelectorAll(".tiktok-slide");
    const totalSlides = slides.length;
    const slider = document.querySelector(".tiktok-slider");

    function moveSlider(direction) {
        currentIndex += direction;
        if (currentIndex < 0) {
            currentIndex = totalSlides - 1;
        } else if (currentIndex >= totalSlides) {
            currentIndex = 0;
        }
        updateSlider();
    }

    function updateSlider() {
        const offset = -currentIndex * (100 / totalSlides);
        slider.style.transform = `translateX(${offset}%)`;
    }

    setInterval(() => {
        moveSlider(1);
    }, 4000); // Mueve el carrusel automáticamente cada 4 segundos
});
</script>
