{% schema %}
{
  "name": "TikTok Slider",
  "settings": [
    {
      "type": "text",
      "id": "rating",
      "label": "Calificaci√≥n (Ejemplo: 4.8)",
      "default": "4.8"
    },
    {
      "type": "text",
      "id": "reviews",
      "label": "N√∫mero de rese√±as",
      "default": "1,450 reviews"
    },
    {
      "type": "text",
      "id": "title",
      "label": "T√≠tulo principal",
      "default": "Opinan de Vitat√∫"
    },
    {
      "type": "textarea",
      "id": "bottom_message",
      "label": "Mensaje inferior",
      "default": "*EL CONSUMO DE ESTE PRODUCTO ES RESPONSABILIDAD DE QUI√âN LO RECOMIENDA Y DE QUI√âN LO USA, ESTE PRODUCTO NO ES UN MEDICAMENTO*"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Color de fondo",
      "default": "#FEF8F0"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color del texto",
      "default": "#333333"
    },
    {
      "type": "url",
      "id": "video_1",
      "label": "TikTok Video 1"
    },
    {
      "type": "url",
      "id": "video_2",
      "label": "TikTok Video 2"
    },
    {
      "type": "url",
      "id": "video_3",
      "label": "TikTok Video 3"
    },
    {
      "type": "url",
      "id": "video_4",
      "label": "TikTok Video 4"
    },
    {
      "type": "url",
      "id": "video_5",
      "label": "TikTok Video 5"
    },
    {
      "type": "url",
      "id": "video_6",
      "label": "TikTok Video 6"
    },
    {
      "type": "url",
      "id": "video_7",
      "label": "TikTok Video 7"
    },
    {
      "type": "url",
      "id": "video_8",
      "label": "TikTok Video 8"
    }
  ],
  "presets": [
    {
      "name": "TikTok Slider",
      "category": "Multimedia"
    }
  ]
}
{% endschema %}

<div class="star-rating">
  <div class="stars">
    {% assign rating_val = section.settings.rating | plus: 0 %}
    {% assign full_stars = rating_val | floor %}
    {% assign empty_stars = 5 | minus: full_stars %}
    {% assign fraction = rating_val | minus: full_stars %}

    {% comment %} Estrellas llenas {% endcomment %}
    {% for i in (1..full_stars) %}
      <span class="star full">&#9733;</span>
    {% endfor %}

    {% comment %} Estrella parcial {% endcomment %}
    {% if fraction > 0 %}
      <div class="partial-star-container">
        <span class="star partial-background">&#9733;</span>
        <span class="star partial-fill" style="width: {{ fraction | times: 100 }}%">&#9733;</span>
      </div>
      {% assign empty_stars = empty_stars | minus: 1 %}
    {% endif %}

    {% comment %} Estrellas vac√≠as {% endcomment %}
    {% for i in (1..empty_stars) %}
      <span class="star empty">&#9733;</span>
    {% endfor %}
  </div>
  <span class="rating-value">{{ rating_val }}</span>
</div>
<style>
  /* Contenedor principal */
  .tiktok-slider-container {
    text-align: center;
    padding: 60px 20px;
    border-radius: 10px;
    position: relative;
    max-width: 1200px;
    margin: 0 auto;
  }
  .tiktok-slider-header { margin-bottom: 40px; }
  .rating-reviews { display: flex; align-items: center; justify-content: center; gap: 15px; font-size: 14px; margin-bottom: 10px; }
  .star-rating { display: flex; align-items: center; gap: 8px; }
  .stars { display: flex; gap: 2px; }
  .rating-value { font-weight: bold; color: #333; }
  .reviews { color: #999; }
  .slider-title { font-size: 32px; font-weight: 700; margin: 0; }
  .tiktok-carousel {
    overflow-x: scroll;
    scroll-behavior: smooth;
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .tiktok-carousel::-webkit-scrollbar { display: none; }
  .tiktok-slider { display: flex; gap: 8px; }
  .tiktok-slide {
    flex: 0 0 calc(100% / 4.5);
    max-width: calc(100% / 4.5);
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }
  .video-container { position: relative; }
  .video-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    cursor: pointer;
    z-index: 5;
    background: transparent;
  }
  .tiktok-embed {
    width: 100%;
    height: 100%;
    border-radius: 12px;
    aspect-ratio: 9 / 16;
    object-fit: cover;
  }
  .nav-button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.6);
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
  }
  .left-button { left: 10px; }
  .right-button { right: 10px; }
  .bottom-message { margin-top: 40px; font-size: 14px; color: #666; }
</style>


<script>
document.addEventListener("DOMContentLoaded", function () {
  let currentPlayingVideo = null;
  let isInitialPlay = true;

  const resetPreviousVideo = () => {
    if (currentPlayingVideo) {
      const videoContainer = currentPlayingVideo.closest('.video-container');
      const overlay = videoContainer.querySelector('.video-overlay');
      
      // Resetear iframe completamente
      const originalSrc = currentPlayingVideo.src.replace("autoplay=1", "autoplay=0");
      currentPlayingVideo.src = originalSrc;
      
      // Restaurar overlay
      overlay.style.display = 'block';
    }
  };

  // ‚ñ∂Ô∏è Controlador de clic para overlays
  document.querySelectorAll('.video-overlay').forEach(overlay => {
    overlay.addEventListener('click', (e) => {
      const videoContainer = e.currentTarget.closest('.video-container');
      const iframe = videoContainer.querySelector('iframe');
      
      // Evitar acci√≥n si es el mismo video
      if (iframe === currentPlayingVideo) return;

      // Manejar primer click diferente
      if (!isInitialPlay) {
        resetPreviousVideo();
      } else {
        isInitialPlay = false;
      }

      // Iniciar nuevo video
      iframe.src = iframe.src.replace("autoplay=0", "autoplay=1");
      e.currentTarget.style.display = 'none';
      currentPlayingVideo = iframe;
    });
  });

  // üéöÔ∏è Funci√≥n de scroll mejorada
  window.scrollSlider = (direction) => {
    const carousel = document.querySelector('.tiktok-carousel');
    const slideWidth = carousel.querySelector('.tiktok-slide').offsetWidth + 8;
    carousel.scrollBy({
      left: slideWidth * direction,
      behavior: 'smooth'
    });
  };
});
</script>
